{
  "backgroundColor": "#FFFFFF",
  "borderColor": "#E0DEDE",
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": "1",
  "bottomRow": 113,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "clickMarker": "{{showAlert(name, '');}}",
  "defaultModel": "{\n\"data\":\"{{screen_map_obj.getMapData.data}}\",\n\"alarmData\":\"{{screen_point_central_recent.data}}\",\n\"selectLevel\":null,\n\"style\":\"{{Header.model.style}}\",\n\"type\":0,\n\"yujingList\":\"{{globalData.yujingList}}\",\n\"shipinList\":\"{{globalData.shipinList}}\"\n}",
  "deleteEvent": "{{screen_point_central_delete.run({\n  \"id\": id\n}).then(() => {\n  showAlert('删除成功！', 'success');\n});}}",
  "displayName": "Custom",
  "dynamicBindingPathList": [
    {
      "key": "theme"
    },
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "defaultModel"
    }
  ],
  "dynamicHeight": "FIXED",
  "dynamicPropertyPathList": [],
  "dynamicTriggerPathList": [
    {
      "key": "videoTypeOnChange"
    },
    {
      "key": "levelConfirm"
    },
    {
      "key": "message"
    },
    {
      "key": "getEvent"
    },
    {
      "key": "falseAlarm"
    },
    {
      "key": "deleteEvent"
    },
    {
      "key": "clickMarker"
    }
  ],
  "events": [
    "videoTypeOnChange",
    "levelConfirm",
    "message",
    "getEvent",
    "falseAlarm",
    "deleteEvent",
    "clickMarker"
  ],
  "falseAlarm": "{{screen_point_central_error.run({\n  \"id\": id\n}).then(() => {\n  showAlert('提交误报成功', 'success');\n});}}",
  "getEvent": "{{screen_point_central_recent.run()}}",
  "hideCard": false,
  "iconSVG": "/static/media/icon.9b1065660dedd39cf997e3faa42244bc.svg",
  "isCanvas": false,
  "isDeprecated": false,
  "isLoading": false,
  "isSearchWildcard": true,
  "isVisible": true,
  "key": "9xik94vnnh",
  "leftColumn": 10,
  "levelConfirm": "{{screen_point_central_confirm.run({\n  \"id\": id,\n  \"level\": selectLevel\n}).then(() => {\n  screen_point_central_recent.run();\n});}}",
  "maxDynamicHeight": 9000,
  "message": "{{showAlert(message, 'warning');}}",
  "minDynamicHeight": 4,
  "mobileBottomRow": 37,
  "mobileLeftColumn": 10,
  "mobileRightColumn": 33,
  "mobileTopRow": 7,
  "needsErrorInfo": false,
  "onCanvasUI": {
    "disableParentSelection": false,
    "focusBGCSSVar": "--on-canvas-ui-widget-focus",
    "focusColorCSSVar": "--on-canvas-ui-widget-selection",
    "selectionBGCSSVar": "--on-canvas-ui-widget-selection",
    "selectionColorCSSVar": "--on-canvas-ui-widget-focus"
  },
  "parentColumnSpace": 29.078125,
  "parentId": "t74yajv9nb",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "rightColumn": 53,
  "searchTags": [
    "external"
  ],
  "srcDoc": {
    "css": ".event-dialog{\n\tpadding: 20px;\n\twidth: calc((var(--appsmith-ui-height) * 1px)/9*5);\n\theight: calc((var(--appsmith-ui-height) * 1px)/5*1.4);\n\tposition: absolute;\n\tbottom: 10px;\n\tright: 10px;\n\tz-index: 999;\n\tfont-size:14px;\n\t.content{\n\t\twidth:100%;\n\t\tpadding-left:0;\n\t\t>img {\n\t\t\twidth:50%;\n\t\t\theight:calc(100%);\n\t\t}\n\n\t\t.right{\n\t\t\theight:100%;\n\t\t\t\n\t\t}\n\n\t\tli{\n\t\t\twidth:100%;\n\t\t\t&:nth-child(4){\n\t\t\t\twhite-space:nowrap;\n\t\t\t}\n\t\t}\n\t}\n\t.top{\n\n\t\t.title{\n\t\t\theight: 28px;\n\t\t\tfont-size:15px;\n\t\t\tbackground: none;\n\t\t\ttext-indent: 0px;\n\t\t}\n\n\t}\n\n\t.footer-bar{\n\t\tpadding:10px 0 0 0;\n\t\tdisplay:flex;\n\t\tjustify-content:flex-end;\n\t}\n\n}\n\nselect{\n\twidth: 60px !importent;\n}",
    "html": "<div id=\"app\">\n\t<div class=\"streetai-map-legend\">\n\t\t<div class=\"top\">\n\t\t\t<!-- <img src=\"../../assets/imgs/streetai/legend_icon.png\" alt /> -->\n\t\t\t<div class=\"title\">资源图层</div>\n\t\t</div>\n\t\t<div class=\"legend_content\">\n\t\t\t<div class=\"title\">预警事件</div>\n\t\t\t<ul>\n\t\t\t\t<li v-for=\"(item,index) in yujingList\" :key=\"index\">\n\t\t\t\t\t<div class=\"title\">{{item.title}}</div>\n\t\t\t\t\t<div v-show=\"!item.isSelected\" class=\"legend-checkbox\" @click=\"onEventChecked(item,index)\"></div>\n\t\t\t\t\t<div v-show=\"item.isSelected\" class=\"legend-checkbox checked\" @click=\"onEventChecked(item,index)\"></div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div class=\"legend_content\">\n\t\t\t<div class=\"title\">视频监控</div>\n\t\t\t<ul>\n\t\t\t\t<li v-for=\"(item,index) in shipinList\" :key=\"index\">\n\t\t\t\t\t<div class=\"title\">{{item.title}}</div>\n\t\t\t\t\t<div v-show=\"!item.isSelected\" class=\"legend-checkbox\" @click=\"onVideoChecked(item,index)\"></div>\n\t\t\t\t\t<div v-show=\"item.isSelected\" class=\"legend-checkbox checked\" @click=\"onVideoChecked(item,index)\"></div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n\t<div class=\"event-dialog\" v-if=\"alarmData\">\n\t\t<div class=\"top\">\n\t\t\t<div class=\"title\">\n\t\t\t\t<i>事件处理</i>\n\t\t\t\t{{countdown}}s\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"content\">\n\t\t\t<img :src=\"alarmData.imgUrl\"/>\n\t\t\t<ul class=\"right\">\n\t\t\t\t<li>告警时间：{{alarmData.alarmDate}}</li>\n\t\t\t\t<li>持续时间：{{alarmData.totalTime || \"-\"}}</li>\n\t\t\t\t<li>事件类别：{{alarmData.alarmTypeName}}</li>\n\t\t\t\t<li>事件等级：\n\t\t\t\t\t<select @change=\"onSelect\" v-if=\"alarmData.handleLevel == null\">\n\t\t\t\t\t\t<option>待确认</option>\n\t\t\t\t\t\t<option>一级</option>\n\t\t\t\t\t\t<option>二级</option>\n\t\t\t\t\t\t<option>三级</option>\n\t\t\t\t\t</select>\n\n\t\t\t\t</li>\n\t\t\t\t<li>告警时间：{{alarmData.address || \"-\"}}</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<ul class=\"button-group footer-bar\"  v-if=\"alarmData.handleLevel == null\">\n\t\t\t<button class=\"danger\" @click=\"falseAlarm\">误报</button>\n\t\t\t<button class=\"danger\" @click=\"deleteEvent\" >删除</button>\n\t\t\t<button class=\"primary\" @click=\"levelConfirm\">确认</button>\n\t\t</ul>\n\t</div>\n\t<div id=\"map\"></div>\n\n</div>\n<script src=\"https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.min.js\"></script>\n<link id=\"aux-style\" rel=\"stylesheet\" href=\"https://test.superton.cn/aux/aux.css\"/>\n<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" integrity=\"sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=\" crossorigin=\"\" />\n<script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\" integrity=\"sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=\" crossorigin=\"\"></script>\n\n<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css\"/>\n<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css\"/>\n<script src=\"https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js\"></script>",
    "js": "appsmith.onReady(() => {\n  /*\n   * This handler function will get called when parent application is ready.\n   * Initialize your component here\n   * more info - https://docs.appsmith.com/reference/widgets/custom#onready\n   */\n  var x_PI = 3.14159265358979324 * 3000.0 / 180.0;\n  var PI = 3.1415926535897932384626;\n  var a = 6378245.0;\n  var ee = 0.00669342162296594323;\n  new Vue({\n    el: \"#app\",\n    data() {\n      return {\n        type: 0,\n        date: 30,\n        yujingList: JSON.parse(appsmith.model.yujingList),\n        shipinList: JSON.parse(appsmith.model.shipinList),\n        map: null,\n        markerCluster: null,\n        timeRange: [\"\", \"\"],\n        alarmData: null,\n        eventShowTimer: null,\n        getEventTimer: null,\n        countdown: 8,\n        selectLevel: null\n      };\n    },\n    mounted() {\n      this.initMap();\n      appsmith.onModelChange(model => {\n        const modelData = JSON.parse(model.data);\n        const alarmData = JSON.parse(model.alarmData);\n        this.selectLevel = null;\n        if (alarmData.length > 0) {\n          this.alarmData = alarmData[0];\n          this.countdown = 8;\n          if (!this.eventShowTimer) {\n            this.eventShowTimer = setInterval(() => {\n              if (this.countdown < 1) {\n                this.alarmData = null;\n                clearInterval(this.eventShowTimer);\n                this.eventShowTimer = null;\n              } else {\n                this.countdown -= 1;\n              }\n            }, 1000);\n          }\n        }\n        if (!this.getEventTimer) {\n          this.getEventTimer = setInterval(() => {\n            appsmith.triggerEvent(\"getEvent\");\n          }, 1000 * 30);\n        }\n        this.addMarkers(modelData);\n        this.switchTheme(model.style);\n        this.map.flyToBounds(this.markerCluster.getBounds());\n      });\n    },\n    methods: {\n      falseAlarm() {\n        appsmith.triggerEvent(\"falseAlarm\", {\n          selectLevel: appsmith.model.selectLevel,\n          ...this.alarmData\n        });\n      },\n      deleteEvent() {\n        appsmith.triggerEvent(\"deleteEvent\", {\n          selectLevel: appsmith.model.selectLevel,\n          ...this.alarmData\n        });\n      },\n      levelConfirm() {\n        if (this.selectLevel) {\n          appsmith.triggerEvent(\"levelConfirm\", {\n            selectLevel: appsmith.model.selectLevel,\n            ...this.alarmData\n          });\n        } else {\n          appsmith.triggerEvent(\"message\", {\n            message: \"请选择告警级别\"\n          });\n        }\n      },\n      onSelect(e) {\n        const value = e.target.value;\n        switch (value) {\n          case \"一级\":\n            this.selectLevel = 1;\n            break;\n          case \"二级\":\n            this.selectLevel = 2;\n            break;\n          case \"三级\":\n            this.selectLevel = 3;\n            break;\n        }\n        appsmith.updateModel({\n          selectLevel: this.selectLevel\n        });\n      },\n      switchTheme(theme) {\n        var themeLink = document.getElementById('aux-style');\n        themeLink.href = `https://test.superton.cn/aux/${theme}.css`;\n      },\n      onEventChecked(item, index) {\n        this.yujingList = this.yujingList.map(data => {\n          data.isSelected = data.title == item.title && data.isSelected == false;\n          return data;\n        });\n        this.timeRange = this.yujingList[index].range;\n        appsmith.updateModel({\n          startTime: this.timeRange[0],\n          endTime: this.timeRange[1]\n        });\n        appsmith.triggerEvent(\"dateOnChange\");\n      },\n      onVideoChecked(item, index) {\n        this.shipinList = this.shipinList.map(data => {\n          data.isSelected = data.title == item.title && data.isSelected == false;\n          return data;\n        });\n        console.log(\"onVideoChecked\", index);\n        // this.type = index\n        appsmith.updateModel({\n          type: index\n        });\n        appsmith.triggerEvent('videoTypeOnChange');\n      },\n      gcj02ToWGS84(lng, lat) {\n        var lat = +lat;\n        var lng = +lng;\n        if (this.out_of_china(lng, lat)) {\n          return [lng, lat];\n        } else {\n          var dlat = this.transformlat(lng - 105.0, lat - 35.0);\n          var dlng = this.transformlng(lng - 105.0, lat - 35.0);\n          var radlat = lat / 180.0 * PI;\n          var magic = Math.sin(radlat);\n          magic = 1 - ee * magic * magic;\n          var sqrtmagic = Math.sqrt(magic);\n          dlat = dlat * 180.0 / (a * (1 - ee) / (magic * sqrtmagic) * PI);\n          dlng = dlng * 180.0 / (a / sqrtmagic * Math.cos(radlat) * PI);\n          var mglat = lat + dlat;\n          var mglng = lng + dlng;\n          return [lng * 2 - mglng, lat * 2 - mglat];\n        }\n        ;\n      },\n      addMarkers(model) {\n        this.markerCluster.clearLayers();\n        if (model.dataList.length == 0 || !this.markerCluster) return;\n        const list = model.dataList.filter(item => item.lonLat != null).map(item => {\n          const lnglat = item.lonLat.split(',');\n          const latlng = this.gcj02ToWGS84(lnglat[0], lnglat[1]);\n          const marker = L.marker(latlng.reverse());\n          marker.bindTooltip(item.name);\n          marker.on(\"click\", () => {\n            console.log(\"点击marker\", item);\n            appsmith.triggerEvent(\"clickMarker\", item);\n          });\n          return marker;\n        });\n        console.log(\"addMarkers\", list);\n        this.markerCluster.addLayers(list);\n        // appsmith.triggerEvent(\"addMarkers\")\n      },\n      initMap() {\n        const layers = this.initLayer();\n        this.map = L.map('map', {\n          layers: layers,\n          center: [29.832422913033476, 121.59343957901002],\n          zoom: 16,\n          maxZoom: 18,\n          minZoom: 3,\n          zoomControl: false,\n          attributionControl: false\n        });\n        this.map.on('click', function (e) {\n          console.log(e);\n        });\n        this.markerCluster = L.markerClusterGroup();\n        this.map.addLayer(this.markerCluster);\n      },\n      initLayer() {\n        const subdomains = [0, 1, 2, 3, 4, 5, 6, 7];\n        return L.layerGroup([L.tileLayer(`http://t{s}.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=aca1b3f6c81ac10a2ef489082a4f291b`, {\n          subdomains: subdomains,\n          zIndex: 1\n        }), L.tileLayer(`http://t{s}.tianditu.gov.cn/cia_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=aca1b3f6c81ac10a2ef489082a4f291b`, {\n          subdomains: subdomains,\n          zIndex: 2\n        })]);\n      },\n      transformlat(lng, lat) {\n        var lat = +lat;\n        var lng = +lng;\n        var ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * Math.sqrt(Math.abs(lng));\n        ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;\n        ret += (20.0 * Math.sin(lat * PI) + 40.0 * Math.sin(lat / 3.0 * PI)) * 2.0 / 3.0;\n        ret += (160.0 * Math.sin(lat / 12.0 * PI) + 320 * Math.sin(lat * PI / 30.0)) * 2.0 / 3.0;\n        return ret;\n      },\n      transformlng(lng, lat) {\n        var lat = +lat;\n        var lng = +lng;\n        var ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * Math.sqrt(Math.abs(lng));\n        ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;\n        ret += (20.0 * Math.sin(lng * PI) + 40.0 * Math.sin(lng / 3.0 * PI)) * 2.0 / 3.0;\n        ret += (150.0 * Math.sin(lng / 12.0 * PI) + 300.0 * Math.sin(lng / 30.0 * PI)) * 2.0 / 3.0;\n        return ret;\n      },\n      /**\n      * 判断是否在国内，不在国内则不做偏移\n      * @param lng\n      * @param lat\n      * @returns {boolean}\n      */\n      out_of_china(lng, lat) {\n        var lat = +lat;\n        var lng = +lng;\n        // 纬度3.86~53.55,经度73.66~135.05 \n        return !(lng > 73.66 && lng < 135.05 && lat > 3.86 && lat < 53.55);\n      }\n    }\n  });\n});"
  },
  "tags": [
    "Display"
  ],
  "theme": "{{appsmith.theme}}",
  "thumbnailSVG": "/static/media/thumbnail.a7d7cde44fad9a0d4d490def43560a78.svg",
  "topRow": 16,
  "type": "CUSTOM_WIDGET",
  "uncompiledSrcDoc": {
    "css": ".event-dialog{\n\tpadding: 20px;\n\twidth: calc((var(--appsmith-ui-height) * 1px)/9*5);\n\theight: calc((var(--appsmith-ui-height) * 1px)/5*1.4);\n\tposition: absolute;\n\tbottom: 10px;\n\tright: 10px;\n\tz-index: 999;\n\tfont-size:14px;\n\t.content{\n\t\twidth:100%;\n\t\tpadding-left:0;\n\t\t>img {\n\t\t\twidth:50%;\n\t\t\theight:calc(100%);\n\t\t}\n\n\t\t.right{\n\t\t\theight:100%;\n\t\t\t\n\t\t}\n\n\t\tli{\n\t\t\twidth:100%;\n\t\t\t&:nth-child(4){\n\t\t\t\twhite-space:nowrap;\n\t\t\t}\n\t\t}\n\t}\n\t.top{\n\n\t\t.title{\n\t\t\theight: 28px;\n\t\t\tfont-size:15px;\n\t\t\tbackground: none;\n\t\t\ttext-indent: 0px;\n\t\t}\n\n\t}\n\n\t.footer-bar{\n\t\tpadding:10px 0 0 0;\n\t\tdisplay:flex;\n\t\tjustify-content:flex-end;\n\t}\n\n}\n\nselect{\n\twidth: 60px !importent;\n}",
    "html": "<div id=\"app\">\n\t<div class=\"streetai-map-legend\">\n\t\t<div class=\"top\">\n\t\t\t<!-- <img src=\"../../assets/imgs/streetai/legend_icon.png\" alt /> -->\n\t\t\t<div class=\"title\">资源图层</div>\n\t\t</div>\n\t\t<div class=\"legend_content\">\n\t\t\t<div class=\"title\">预警事件</div>\n\t\t\t<ul>\n\t\t\t\t<li v-for=\"(item,index) in yujingList\" :key=\"index\">\n\t\t\t\t\t<div class=\"title\">{{item.title}}</div>\n\t\t\t\t\t<div v-show=\"!item.isSelected\" class=\"legend-checkbox\" @click=\"onEventChecked(item,index)\"></div>\n\t\t\t\t\t<div v-show=\"item.isSelected\" class=\"legend-checkbox checked\" @click=\"onEventChecked(item,index)\"></div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div class=\"legend_content\">\n\t\t\t<div class=\"title\">视频监控</div>\n\t\t\t<ul>\n\t\t\t\t<li v-for=\"(item,index) in shipinList\" :key=\"index\">\n\t\t\t\t\t<div class=\"title\">{{item.title}}</div>\n\t\t\t\t\t<div v-show=\"!item.isSelected\" class=\"legend-checkbox\" @click=\"onVideoChecked(item,index)\"></div>\n\t\t\t\t\t<div v-show=\"item.isSelected\" class=\"legend-checkbox checked\" @click=\"onVideoChecked(item,index)\"></div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n\t<div class=\"event-dialog\" v-if=\"alarmData\">\n\t\t<div class=\"top\">\n\t\t\t<div class=\"title\">\n\t\t\t\t<i>事件处理</i>\n\t\t\t\t{{countdown}}s\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"content\">\n\t\t\t<img :src=\"alarmData.imgUrl\"/>\n\t\t\t<ul class=\"right\">\n\t\t\t\t<li>告警时间：{{alarmData.alarmDate}}</li>\n\t\t\t\t<li>持续时间：{{alarmData.totalTime || \"-\"}}</li>\n\t\t\t\t<li>事件类别：{{alarmData.alarmTypeName}}</li>\n\t\t\t\t<li>事件等级：\n\t\t\t\t\t<select @change=\"onSelect\" v-if=\"alarmData.handleLevel == null\">\n\t\t\t\t\t\t<option>待确认</option>\n\t\t\t\t\t\t<option>一级</option>\n\t\t\t\t\t\t<option>二级</option>\n\t\t\t\t\t\t<option>三级</option>\n\t\t\t\t\t</select>\n\n\t\t\t\t</li>\n\t\t\t\t<li>告警时间：{{alarmData.address || \"-\"}}</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<ul class=\"button-group footer-bar\"  v-if=\"alarmData.handleLevel == null\">\n\t\t\t<button class=\"danger\" @click=\"falseAlarm\">误报</button>\n\t\t\t<button class=\"danger\" @click=\"deleteEvent\" >删除</button>\n\t\t\t<button class=\"primary\" @click=\"levelConfirm\">确认</button>\n\t\t</ul>\n\t</div>\n\t<div id=\"map\"></div>\n\n</div>\n<script src=\"https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.min.js\"></script>\n<link id=\"aux-style\" rel=\"stylesheet\" href=\"https://test.superton.cn/aux/aux.css\"/>\n<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" integrity=\"sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=\" crossorigin=\"\" />\n<script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\" integrity=\"sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=\" crossorigin=\"\"></script>\n\n<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css\"/>\n<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css\"/>\n<script src=\"https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js\"></script>",
    "js": "appsmith.onReady(() => {\n\t/*\n\t * This handler function will get called when parent application is ready.\n\t * Initialize your component here\n\t * more info - https://docs.appsmith.com/reference/widgets/custom#onready\n\t */\n\tvar x_PI = 3.14159265358979324 * 3000.0 / 180.0;\n\tvar PI = 3.1415926535897932384626;\n\tvar a = 6378245.0;\n\tvar ee = 0.00669342162296594323;\n\tnew Vue({\n\t\tel: \"#app\",\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttype:0,\n\t\t\t\tdate:30,\n\t\t\t\tyujingList:JSON.parse(appsmith.model.yujingList),\n\t\t\t\tshipinList: JSON.parse(appsmith.model.shipinList),\n\t\t\t\tmap:null,\n\t\t\t\tmarkerCluster:null,\n\t\t\t\ttimeRange:[\"\",\"\"],\n\t\t\t\talarmData:null,\n\t\t\t\teventShowTimer:null,\n\t\t\t\tgetEventTimer:null,\n\t\t\t\tcountdown:8,\n\t\t\t\tselectLevel:null\n\t\t\t};\n\t\t},\n\t\tmounted(){\n\t\t\tthis.initMap()\n\t\t\tappsmith.onModelChange((model)=>{\n\t\t\t\tconst modelData = JSON.parse(model.data)\n\t\t\t\tconst alarmData = JSON.parse(model.alarmData)\n\t\t\t\tthis.selectLevel = null\n\t\t\t\tif (alarmData.length > 0){\n\t\t\t\t\tthis.alarmData = alarmData[0]\n\t\t\t\t\tthis.countdown = 8\n\t\t\t\t\tif (!this.eventShowTimer){\n\t\t\t\t\t\tthis.eventShowTimer = setInterval(()=>{\n\t\t\t\t\t\t\tif(this.countdown < 1){\n\t\t\t\t\t\t\t\tthis.alarmData = null\n\t\t\t\t\t\t\t\tclearInterval(this.eventShowTimer)\n\t\t\t\t\t\t\t\tthis.eventShowTimer = null\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tthis.countdown -= 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},1000)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!this.getEventTimer){\n\t\t\t\t\tthis.getEventTimer = setInterval(()=>{\n\t\t\t\t\t\tappsmith.triggerEvent(\"getEvent\")\n\t\t\t\t\t},1000*30)\n\t\t\t\t}\n\t\t\t\tthis.addMarkers(modelData)\n\t\t\t\tthis.switchTheme(model.style)\n\t\t\t\tthis.map.flyToBounds(this.markerCluster.getBounds())\n\t\t\t})\n\t\t},\n\t\tmethods: {\n\t\t\tfalseAlarm(){\n\t\t\t\tappsmith.triggerEvent(\"falseAlarm\",{\n\t\t\t\t\tselectLevel:appsmith.model.selectLevel,\n\t\t\t\t\t...this.alarmData\n\t\t\t\t})\n\t\t\t},\n\t\t\tdeleteEvent(){\n\t\t\t\tappsmith.triggerEvent(\"deleteEvent\",{\n\t\t\t\t\tselectLevel:appsmith.model.selectLevel,\n\t\t\t\t\t...this.alarmData\n\t\t\t\t})\n\t\t\t},\n\t\t\tlevelConfirm(){\n\t\t\t\tif (this.selectLevel){\n\t\t\t\t\tappsmith.triggerEvent(\"levelConfirm\",{\n\t\t\t\t\t\tselectLevel:appsmith.model.selectLevel,\n\t\t\t\t\t\t...this.alarmData\n\t\t\t\t\t})\n\t\t\t\t}else{\n\t\t\t\t\tappsmith.triggerEvent(\"message\",{message:\"请选择告警级别\"})\n\t\t\t\t}\n\t\t\t},\n\t\t\tonSelect(e){\n\t\t\t\tconst value = e.target.value\n\n\t\t\t\tswitch(value){\n\t\t\t\t\tcase \"一级\":\n\t\t\t\t\t\tthis.selectLevel = 1\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase \"二级\":\n\t\t\t\t\t\tthis.selectLevel = 2\t\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase \"三级\":\n\t\t\t\t\t\tthis.selectLevel = 3\n\t\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tappsmith.updateModel({selectLevel:this.selectLevel})\t\n\t\t\t},\n\t\t\tswitchTheme(theme) {\n\t\t\t\tvar themeLink = document.getElementById('aux-style');\n\t\t\t\tthemeLink.href = `https://test.superton.cn/aux/${theme}.css`;\n\t\t\t},\n\t\t\tonEventChecked(item,index){\n\t\t\t\tthis.yujingList = this.yujingList.map(data => {\n\t\t\t\t\tdata.isSelected = data.title == item.title && data.isSelected == false\n\t\t\t\t\treturn data\n\t\t\t\t})\n\t\t\t\tthis.timeRange = this.yujingList[index].range\n\t\t\t\tappsmith.updateModel({startTime:this.timeRange[0],endTime:this.timeRange[1]})\n\t\t\t\tappsmith.triggerEvent(\"dateOnChange\")\n\t\t\t},\n\t\t\tonVideoChecked(item,index){\n\t\t\t\tthis.shipinList = this.shipinList.map(data => {\n\t\t\t\t\tdata.isSelected = data.title == item.title && data.isSelected == false\n\t\t\t\t\treturn data\n\t\t\t\t})\n\t\t\t\tconsole.log(\"onVideoChecked\",index)\n\t\t\t\t// this.type = index\n\t\t\t\tappsmith.updateModel({type:index})\n\t\t\t\tappsmith.triggerEvent('videoTypeOnChange')\n\t\t\t},\n\t\t\tgcj02ToWGS84(lng, lat){\n\t\t\t\tvar lat = +lat;\n\t\t\t\tvar lng = +lng;\n\t\t\t\tif (this.out_of_china(lng, lat)) {\n\t\t\t\t\treturn [lng, lat]\n\t\t\t\t} else {\n\t\t\t\t\tvar dlat = this.transformlat(lng - 105.0, lat - 35.0);\n\t\t\t\t\tvar dlng = this.transformlng(lng - 105.0, lat - 35.0);\n\t\t\t\t\tvar radlat = lat / 180.0 * PI;\n\t\t\t\t\tvar magic = Math.sin(radlat);\n\t\t\t\t\tmagic = 1 - ee * magic * magic;\n\t\t\t\t\tvar sqrtmagic = Math.sqrt(magic);\n\t\t\t\t\tdlat = (dlat * 180.0) / ((a * (1 - ee)) / (magic * sqrtmagic) * PI);\n\t\t\t\t\tdlng = (dlng * 180.0) / (a / sqrtmagic * Math.cos(radlat) * PI);\n\t\t\t\t\tvar mglat = lat + dlat;\n\t\t\t\t\tvar mglng = lng + dlng;\n\t\t\t\t\treturn [lng * 2 - mglng, lat * 2 - mglat]\n\t\t\t\t};\n\t\t\t},\n\t\t\taddMarkers(model){\n\t\t\t\tthis.markerCluster.clearLayers()\n\t\t\t\tif (model.dataList.length == 0 || !this.markerCluster) return\n\t\t\t\tconst list = model.dataList\n\t\t\t\t.filter(item=>item.lonLat != null)\n\t\t\t\t.map(item=>{\n\t\t\t\t\tconst lnglat = item.lonLat.split(',')\n\t\t\t\t\tconst latlng = this.gcj02ToWGS84(lnglat[0],lnglat[1])\n\t\t\t\t\tconst marker = L.marker(latlng.reverse())\n\t\t\t\t\tmarker.bindTooltip(item.name)\n\t\t\t\t\tmarker.on(\"click\",()=>{\n\t\t\t\t\t\tconsole.log(\"点击marker\",item)\n\t\t\t\t\t\tappsmith.triggerEvent(\"clickMarker\",item)\n\t\t\t\t\t})\n\t\t\t\t\treturn marker\n\t\t\t\t})\n\n\t\t\t\tconsole.log(\"addMarkers\",list)\n\t\t\t\tthis.markerCluster.addLayers(list);\n\t\t\t\t// appsmith.triggerEvent(\"addMarkers\")\n\n\t\t\t},\n\t\t\tinitMap(){\n\t\t\t\tconst layers = this.initLayer()\n\t\t\t\tthis.map = L.map('map',{\n\t\t\t\t\tlayers:layers,\n\t\t\t\t\tcenter: [29.832422913033476, 121.59343957901002],\n\t\t\t\t\tzoom: 16,\n\t\t\t\t\tmaxZoom: 18,\n\t\t\t\t\tminZoom: 3,\n\t\t\t\t\tzoomControl:false,\n\t\t\t\t\tattributionControl:false\n\t\t\t\t})\n\t\t\t\tthis.map.on('click',function(e){\n\t\t\t\t\tconsole.log(e)\n\t\t\t\t})\n\t\t\t\tthis.markerCluster = L.markerClusterGroup();\n\t\t\t\tthis.map.addLayer(this.markerCluster)\n\t\t\t},\n\t\t\tinitLayer(){\n\t\t\t\tconst subdomains = [0, 1, 2, 3, 4, 5, 6, 7]\n\t\t\t\treturn L.layerGroup([\n\t\t\t\t\tL.tileLayer(\n\t\t\t\t\t\t`http://t{s}.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=aca1b3f6c81ac10a2ef489082a4f291b`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubdomains: subdomains,\n\t\t\t\t\t\t\tzIndex: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tL.tileLayer(\n\t\t\t\t\t\t`http://t{s}.tianditu.gov.cn/cia_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=aca1b3f6c81ac10a2ef489082a4f291b`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubdomains: subdomains,\n\t\t\t\t\t\t\tzIndex: 2\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t])\n\t\t\t},\n\t\t\ttransformlat(lng, lat) {\n\t\t\t\tvar lat = +lat;\n\t\t\t\tvar lng = +lng;\n\t\t\t\tvar ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * Math.sqrt(Math.abs(lng));\n\t\t\t\tret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;\n\t\t\t\tret += (20.0 * Math.sin(lat * PI) + 40.0 * Math.sin(lat / 3.0 * PI)) * 2.0 / 3.0;\n\t\t\t\tret += (160.0 * Math.sin(lat / 12.0 * PI) + 320 * Math.sin(lat * PI / 30.0)) * 2.0 / 3.0;\n\t\t\t\treturn ret\n\t\t\t},\n\t\t\ttransformlng(lng, lat) {\n\t\t\t\tvar lat = +lat;\n\t\t\t\tvar lng = +lng;\n\t\t\t\tvar ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * Math.sqrt(Math.abs(lng));\n\t\t\t\tret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;\n\t\t\t\tret += (20.0 * Math.sin(lng * PI) + 40.0 * Math.sin(lng / 3.0 * PI)) * 2.0 / 3.0;\n\t\t\t\tret += (150.0 * Math.sin(lng / 12.0 * PI) + 300.0 * Math.sin(lng / 30.0 * PI)) * 2.0 / 3.0;\n\t\t\t\treturn ret\n\t\t\t},\n\n\t\t\t/**\n   * 判断是否在国内，不在国内则不做偏移\n   * @param lng\n   * @param lat\n   * @returns {boolean}\n   */\n\t\t\tout_of_china(lng, lat) {\n\t\t\t\tvar lat = +lat;\n\t\t\t\tvar lng = +lng;\n\t\t\t\t// 纬度3.86~53.55,经度73.66~135.05 \n\t\t\t\treturn !(lng > 73.66 && lng < 135.05 && lat > 3.86 && lat < 53.55);\n\t\t\t},\n\t\t},\n\t});\n});\n"
  },
  "version": 1,
  "videoTypeOnChange": "{{screen_map_obj.getMapData();\nshowAlert('切换视频监控类型', 'info');}}",
  "widgetId": "d6r76ouug3",
  "widgetName": "MapView"
}